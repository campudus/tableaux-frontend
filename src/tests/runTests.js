import unitTests from "./simpleTests";
import * as f from "lodash/fp";

const modulesWithTests = [
  require("./simpleTests"),
  require("../main/js/helpers/monads"),
  require("../main/js/models/getDisplayValue")
];

const columnsFromDatabase = JSON.parse('[{"id":0,"name":"ID","kind":"concat","ordering":0,"multilanguage":true,"identifier":true,"concats":[{"id":2,"ordering":1,"name":"manufacturer","kind":"link","multilanguage":false,"identifier":true,"displayName":{"de":"Hersteller","en":"Manufacturer","fr":"Fabricant","es":"Fabricante"},"description":{},"toTable":2,"toColumn":{"id":1,"ordering":1,"name":"name","kind":"shorttext","multilanguage":false,"identifier":true,"displayName":{"de":"Name","en":"Name","fr":"Nom","es":"Nombre"},"description":{}}},{"id":1,"ordering":2,"name":"identifier","kind":"shorttext","multilanguage":false,"identifier":true,"displayName":{"de":"Bezeichnung","en":"Identifier","fr":"Désignation","es":"Descripción"},"description":{}},{"id":16,"ordering":2,"name":"extendedIdentifier","kind":"shorttext","multilanguage":true,"identifier":true,"displayName":{"de":"Erweiterte Bezeichnung","en":"Extended identifier","fr":"Désignation avancée","es":"Descripción avanzada"},"description":{},"languageType":"language"},{"id":17,"ordering":2,"name":"internalDescription","kind":"shorttext","multilanguage":false,"identifier":true,"displayName":{"de":"Interne Bezeichnung","en":"Internal Description"},"description":{}},{"id":3,"ordering":3,"name":"power","kind":"numeric","multilanguage":false,"identifier":true,"displayName":{"en":"Power (Z in Watt)","es":"Rendimiento (en vatios)","de":"Leistung (Z in Watt)","fr":"Puissance (en Watt)"},"description":{}}],"groups":null,"displayName":{},"description":{},"languageType":"language","countryCodes":null,"format":null},{"id":2,"name":"manufacturer","kind":"link","ordering":1,"multilanguage":false,"identifier":true,"concats":null,"groups":null,"displayName":{"de":"Hersteller","en":"Manufacturer","fr":"Fabricant","es":"Fabricante"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":1,"name":"identifier","kind":"shorttext","ordering":2,"multilanguage":false,"identifier":true,"concats":null,"groups":null,"displayName":{"de":"Bezeichnung","en":"Identifier","fr":"Désignation","es":"Descripción"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":16,"name":"extendedIdentifier","kind":"shorttext","ordering":2,"multilanguage":true,"identifier":true,"concats":null,"groups":null,"displayName":{"de":"Erweiterte Bezeichnung","en":"Extended identifier","fr":"Désignation avancée","es":"Descripción avanzada"},"description":{},"languageType":"language","countryCodes":null,"format":null},{"id":17,"name":"internalDescription","kind":"shorttext","ordering":2,"multilanguage":false,"identifier":true,"concats":null,"groups":null,"displayName":{"de":"Interne Bezeichnung","en":"Internal Description"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":3,"name":"power","kind":"numeric","ordering":3,"multilanguage":false,"identifier":true,"concats":null,"groups":null,"displayName":{"en":"Power (Z in Watt)","es":"Rendimiento (en vatios)","de":"Leistung (Z in Watt)","fr":"Puissance (en Watt)"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":4,"name":"torque","kind":"numeric","ordering":4,"multilanguage":false,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Drehmoment (Z in Nm)","en":"Torque (Z in Nm)","fr":"Couple (en Nm)","es":"Par de motor (en Nm)"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":5,"name":"speedLimit","kind":"numeric","ordering":5,"multilanguage":false,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Abriegelung (Z in km/h)","en":"Speed limit (Z in km/h)","fr":"Vitesse max. (km/h)","es":"Máxima velocidad (en km/h)"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":7,"name":"speedLimitUS","kind":"numeric","ordering":5,"multilanguage":false,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Abriegelung US (Z in mph)","en":"Speed limit US (Z in mph)","fr":"Vitesse max. US (mph)","es":"Máxima velocidad US (en mph)"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":6,"name":"levelsOfAssitance","kind":"numeric","ordering":6,"multilanguage":false,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Fahrstufen","en":"Levels of assistance","fr":"Niveaux d assistance","es":"Nivel de asistencia"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":8,"name":"marketingHeadline","kind":"shorttext","ordering":8,"multilanguage":true,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Marketing Überschrift","en":"Marketing Headline"},"description":{},"languageType":"language","countryCodes":null,"format":null},{"id":9,"name":"descriptionShort","kind":"text","ordering":9,"multilanguage":true,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Kurzbeschreibung","en":"Short description"},"description":{},"languageType":"language","countryCodes":null,"format":null},{"id":10,"name":"description","kind":"text","ordering":10,"multilanguage":true,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Beschreibung","en":"Description"},"description":{},"languageType":"language","countryCodes":null,"format":null},{"id":11,"name":"previewImage","kind":"attachment","ordering":11,"multilanguage":false,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Vorschaubild","en":"Preview image"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":12,"name":"detailedImages","kind":"attachment","ordering":12,"multilanguage":false,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Detailbilder","en":"Detailed images"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":13,"name":"productImageFreeForm","kind":"attachment","ordering":13,"multilanguage":false,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Produktfreisteller (HQ-Bild)","en":"Product image (Free-Form Select)"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":14,"name":"youtubeLink","kind":"shorttext","ordering":14,"multilanguage":true,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Youtube-Link","en":"Youtube-Link"},"description":{},"languageType":"language","countryCodes":null,"format":null},{"id":15,"name":"instructionManual","kind":"attachment","ordering":15,"multilanguage":false,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Bedienungsanleitung","en":"Instruction manual"},"description":{},"languageType":null,"countryCodes":null,"format":null},{"id":18,"name":"testReport","kind":"link","ordering":18,"multilanguage":true,"identifier":false,"concats":null,"groups":null,"displayName":{"de":"Prüf-/Testbericht"},"description":{},"languageType":"language","countryCodes":null,"format":null}]');
const rowFromDataBase = JSON.parse('{"id":1,"values":[[[{"id":1,"value":"Shimano"},{"id":2,"value":"Sram "},{"id":10,"value":"Bosch"}],"Active Cruise",{"de":""},"BDU2...",250],[{"id":1,"value":"Shimano"},{"id":2,"value":"Sram "},{"id":10,"value":"Bosch"}],"Active Cruise",{"de":""},"BDU2...",250,50,25,null,null,{"de":""},{"de":""},{"de":"Der Performance Cruise Antrieb ist ein leistungsfähiger und zuverlässiger Antrieb der Pedelec-Klasse.","en":"The Performance Cruise Antrieb is a powerful and reliable pedelec engine.","es":""},[{"internalName":{"cs":"eaa520e8-536a-4c0e-a46c-100a262d558c.pdf","de":"4d253c78-2d95-4708-a59c-7495996bd5ac.pdf","en-US":"7b5034d5-212b-4d8a-84b9-9347ed20c9ee.pdf","en":"5433a4a8-c661-48db-aaa1-67817b81ad28.pdf","it":"192817ca-c50e-4453-aad1-d95f42e8723e.pdf","fr":"37123dea-b259-4711-b1ee-b7524cd54fc7.pdf","pl":"059e7d2c-4997-48fa-862e-2227057f2471.pdf","es":"d507e0bc-0dfa-42ed-a431-61ab2e717998.pdf"},"createdAt":"2017-02-07T18:14:23.804+01:00","folder":114,"folders":[55,77,114],"ordering":1,"externalName":{"cs":"170209_Anschreiben Endverbraucher Haibike Rückruf_CZ.pdf","de":"170209_Anschreiben Endverbraucher Haibike Rückruf.pdf","en-US":"170214_Anschreiben Endverbraucher Haibike Rückruf_US.pdf","en":"170209_Anschreiben Endverbraucher Haibike Rückruf_ENG.pdf","it":"170209_Anschreiben Endverbraucher Haibike Rückruf_ITA.pdf","fr":"170209_Anschreiben Endverbraucher Haibike Rückruf_FRA.pdf","pl":"170209_Anschreiben Endverbraucher Haibike Rückruf_PL.pdf","es":"170209_Anschreiben Endverbraucher Haibike Rückruf_ESP.pdf"},"description":{"de":""},"mimeType":{"cs":"application/pdf","de":"application/pdf","en-US":"application/pdf","en":"application/pdf","it":"application/pdf","fr":"application/pdf","pl":"application/pdf","es":"application/pdf"},"title":{"de":"Endkundeninformation Rückruf Haibike Gabel","es":"Aviso a los clientes finales de la retirada de la horquilla Haibike "},"uuid":"57d999f5-852c-4482-bd7e-8c5ed48593d4","url":{"cs":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/cs/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_CZ.pdf","de":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/de/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf.pdf","en-US":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/en-US/170214_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_US.pdf","en":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/en/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_ENG.pdf","it":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/it/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_ITA.pdf","fr":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/fr/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_FRA.pdf","pl":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/pl/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_PL.pdf","es":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/es/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_ESP.pdf"},"updatedAt":"2017-02-14T15:30:58.698+01:00"},{"internalName":{"de":"f505acd4-3524-49c9-a630-0aa71b20768d.jpg"},"createdAt":"2016-08-28T12:15:43.289+02:00","folder":73,"folders":[55,71,73],"ordering":2,"externalName":{"de":"Haibike_Website_Heroes_Max_Semsch-1.jpg"},"description":{"de":""},"mimeType":{"de":"image/jpeg"},"title":{"de":"Haibike_Website_Heroes_Max_Semsch-1.jpg"},"uuid":"3ed848e6-80af-468d-829c-d6f72dba9b98","url":{"de":"/files/3ed848e6-80af-468d-829c-d6f72dba9b98/de/Haibike_Website_Heroes_Max_Semsch-1.jpg"},"updatedAt":"2016-08-28T12:15:49.659+02:00"}],[],[],{},[],[]],"annotations":[null,null,null,null,null,null,null,null,null,null,[{"uuid":"d5209bcc-5bfd-4ae5-933f-5a7b2153543d","type":"flag","value":"needs_translation","createdAt":"2017-06-12T14:01:38.528Z","langtags":["en","en-US","fr","it","es","pl","nl","cs"]}],null,null,null,null,null,null,null,null],"final":false,"cells":[{"value":[[{"id":1,"value":"Shimano"},{"id":2,"value":"Sram "},{"id":10,"value":"Bosch"}],"Active Cruise",{"de":""},"BDU2...",250]},{"value":{"values":[1,2,10]}},{"value":"Active Cruise"},{"value":{"de":""}},{"value":"BDU2..."},{"value":250},{"value":50},{"value":25},{"value":null},{"value":null},{"value":{"de":""}},{"value":{"de":""}},{"value":{"de":"Der Performance Cruise Antrieb ist ein leistungsfähiger und zuverlässiger Antrieb der Pedelec-Klasse.","en":"Der Performance Cruise Antrieb ist ein leistungsfähiger und zuverlässiger Antrieb der Pedelec-Klasse.","es":""}},{"value":[{"internalName":{"cs":"eaa520e8-536a-4c0e-a46c-100a262d558c.pdf","de":"4d253c78-2d95-4708-a59c-7495996bd5ac.pdf","en-US":"7b5034d5-212b-4d8a-84b9-9347ed20c9ee.pdf","en":"5433a4a8-c661-48db-aaa1-67817b81ad28.pdf","it":"192817ca-c50e-4453-aad1-d95f42e8723e.pdf","fr":"37123dea-b259-4711-b1ee-b7524cd54fc7.pdf","pl":"059e7d2c-4997-48fa-862e-2227057f2471.pdf","es":"d507e0bc-0dfa-42ed-a431-61ab2e717998.pdf"},"createdAt":"2017-02-07T18:14:23.804+01:00","folder":114,"folders":[55,77,114],"ordering":1,"externalName":{"cs":"170209_Anschreiben Endverbraucher Haibike Rückruf_CZ.pdf","de":"170209_Anschreiben Endverbraucher Haibike Rückruf.pdf","en-US":"170214_Anschreiben Endverbraucher Haibike Rückruf_US.pdf","en":"170209_Anschreiben Endverbraucher Haibike Rückruf_ENG.pdf","it":"170209_Anschreiben Endverbraucher Haibike Rückruf_ITA.pdf","fr":"170209_Anschreiben Endverbraucher Haibike Rückruf_FRA.pdf","pl":"170209_Anschreiben Endverbraucher Haibike Rückruf_PL.pdf","es":"170209_Anschreiben Endverbraucher Haibike Rückruf_ESP.pdf"},"description":{"de":""},"mimeType":{"cs":"application/pdf","de":"application/pdf","en-US":"application/pdf","en":"application/pdf","it":"application/pdf","fr":"application/pdf","pl":"application/pdf","es":"application/pdf"},"title":{"de":"Endkundeninformation Rückruf Haibike Gabel","es":"Aviso a los clientes finales de la retirada de la horquilla Haibike "},"uuid":"57d999f5-852c-4482-bd7e-8c5ed48593d4","url":{"cs":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/cs/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_CZ.pdf","de":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/de/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf.pdf","en-US":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/en-US/170214_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_US.pdf","en":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/en/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_ENG.pdf","it":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/it/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_ITA.pdf","fr":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/fr/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_FRA.pdf","pl":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/pl/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_PL.pdf","es":"/files/57d999f5-852c-4482-bd7e-8c5ed48593d4/es/170209_Anschreiben+Endverbraucher+Haibike+R%C3%BCckruf_ESP.pdf"},"updatedAt":"2017-02-14T15:30:58.698+01:00"},{"internalName":{"de":"f505acd4-3524-49c9-a630-0aa71b20768d.jpg"},"createdAt":"2016-08-28T12:15:43.289+02:00","folder":73,"folders":[55,71,73],"ordering":2,"externalName":{"de":"Haibike_Website_Heroes_Max_Semsch-1.jpg"},"description":{"de":""},"mimeType":{"de":"image/jpeg"},"title":{"de":"Haibike_Website_Heroes_Max_Semsch-1.jpg"},"uuid":"3ed848e6-80af-468d-829c-d6f72dba9b98","url":{"de":"/files/3ed848e6-80af-468d-829c-d6f72dba9b98/de/Haibike_Website_Heroes_Max_Semsch-1.jpg"},"updatedAt":"2016-08-28T12:15:49.659+02:00"}]},{"value":[]},{"value":[]},{"value":{}},{"value":[]},{"value":{"values":[]}}]}');
const cells = f.zip(rowFromDataBase.values, columnsFromDatabase)
               .map(
                 ([cell, column]) => ({value: cell, column})
               );

const runTest = testObj => (f.isArray(testObj))
  ? testObj.forEach(runTest)
  : unitTests(testObj.title)(testObj.tests);

const summary = f.reduce(
  (a, b) => ({
    total: a.total + b.total,
    failed: a.failed + b.failed,
    success: a.success + b.success
  }),
  {total: 0, success: 0, failed: 0},

  modulesWithTests
    .map(
      function (mod) {
        return runTest(mod.tests);
      }
    )
);

console.warn(`TEST SUMMARY\n-----------\n${f.size(modulesWithTests)}  modules tested, ${summary.total} tests run, ${summary.failed} tests failed`);
